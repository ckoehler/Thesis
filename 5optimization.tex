In this section the setup and results of the simulations will be presented. First, the way the 
simulations were conducted is explained. After that, the results for various waveforms will be 
presented.

\section{Setup and Configuration}
All simulations were performed with the MATLAB\textsuperscript{\textregistered} software package.
The general algorithm to compute the ambiguity function is presented, with the complete code
given in Appendix \ref{app:code}.


\subsection{Generating Waveforms}
The simulation is done in multiple parts. First, a waveform is generated based on a given
amplitude, phase, frequency modulation, and impulse response that is applied to the signal.
The returned waveform is generated at a proper sampling frequency in order to avoid aliasing.

If an impulse response was supplied, we get both the distorted and clean waveform back, as well as
the new pulse length $\tau$ which will be approximately twice the original $\tau$. That lengthening
is due to the convolution of the original waveform $u(t)$ with the impulse response $h(t)$.

\subsection{Calculating the Ambiguity Function}
Once we have the waveform, we generate the AF and plot it as a surface plot. 
In pseudo-code, given the complex signal \emph{signal} and an array of Doppler frequencies \emph{doppler\_frequencies}
to compute the normalized AF for:

\lstset{
  basicstyle=\footnotesize
}
\begin{lstlisting}[language=Ruby]
af = []
for dfreq in doppler_freqencies do
  doppler_shift = exp(-j*2*pi*dfreq)
  shifted_signal = signal*doppler_shift
  af << abs(xcorr(signal, shifted_signal))
end
return (af / max(af))

\end{lstlisting}









\section{Simple pulse}
A rectangular pulse is the simplest waveform for a radar. These graphs show the AF for pulses of varying lengths so we can 
evaluate the effect of pulse length on Doppler resistance. As we predicted in \ref{s:dopplereffect}, if the 
pulse length is much smaller than the inverse of the bandwidth, the Doppler effect 

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/pulse-1us.png}
\caption{ Simple pulse of length 1 $\mu s$ }
\label{fig:simplepulse-1us}
\end{figure}

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/pulse-200us.png}
\caption{ Simple pulse of length 200 $\mu s$ }
\label{fig:simplepulse-200us}
\end{figure}









\section{Barker code}
Next we will examine a length 13 Barker code of different pulse lengths. Again we notice that
Doppler tolerance decreases with a longer pulse.

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/barker-1us.png}
\caption{ Barker 13 of length 1 $\mu s$ }
\label{fig:barker13-1us}
\end{figure}

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/barker-200us.png}
\caption{ Barker 13 of length 200 $\mu s$ }
\label{fig:barker13-200us}
\end{figure}











\section{Linear Frequency Modulation}
Here the results of different variations of linear frequency modulation will be presented, specifically LFM with
and without amplitude tapering.

\subsection{Linear Frequency Modulation}
Here we will look at the performance results of a linearly frequency modulated waveform. 
As expected, the figures below show that the Doppler
performance of an LFM waveform is very high, especially for our weather radar application. There is no visible
difference between the AFs in the Doppler dimension.

The frequency modulation function is shown in figure \ref{fig:lfm-fmf}.

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/lfm-fmf.png}
\caption{Linear frequency modulation function}
\label{fig:lfm-fmf}
\end{figure}


Comparing the two AFs to determine the difference that the pulse length makes, we see that in the Doppler
direction, the waveform does not change significantly. To get a better understanding of the difference 
in range resolution, let's look at the zero Doppler cut in figures \ref{fig:lfm-15us-0d} and \ref{fig:lfm-200us-0d}.

We see the expected shape with sidelobes around -13 dB in both AFs, and the shapes are approximately the same
for each case, which means that the pulse length has little effect on the range resolution, which is determined
by the bandwidth swept instead. These figures confirm that observation.

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/lfm-15us.png}
\caption{ LFM of length 15 $\mu s$ }
\label{fig:lfm-15us}
\includegraphics[width=\imgsize]{figures/lfm-200us.png}
\caption{ LFM of length 200 $\mu s$ }
\label{fig:lfm-200us}
\end{figure}



\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/lfm-15us-0D.png}
\caption{ LFM of length 15 $\mu s$, zero Doppler cut. }
\label{fig:lfm-15us-0d}
\includegraphics[width=\imgsize]{figures/lfm-200us-0D.png}
\caption{ LFM of length 200 $\mu s$, zero Doppler cut. }
\label{fig:lfm-200us-0d}
\end{figure}


\subsection{Linear Frequency Modulation with Amplitude Tapering}
The AF of a LFM waveform has fairly high sidelobes that we can try to mitigate with amplitude tapering.
For that, a Kaiser window is applied to the amplitude. Based on Equation \eqref{eq:kaiser2}, the parameter $\beta$ is
varied from 0 to 50, and the AF generated and evaluated for each. The results are shown in figure \ref{fig:lfm-isl-15us-opti}.
As expected, the ISL dramatically decreases, as does the MSL. At the same time, the range resolution decreases from
an initial 60 m to about 400 m. The PPR may be the limiting metric here. The tapered signal quickly
loses half of its energy with only minor amplitude tapering and eventually decreases to about 0.2, which means
the signal loses 80\% of its energy. 



\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/lfm-isl-15us-opti.png}
\caption{Optimization results for LFM with Kaiser amplitude tapering}
\label{fig:lfm-isl-15us-opti}
\end{figure}


Clearly, a tradeoff must be made. If the half power point is selected, the waveform would have an ISL of about -22 dB, 
MSL of -35 dB, and a range resolution of 75 m.

The corresponding zero Doppler cut of the AF at this point is shown in figure \ref{fig:lfm-isl-15us-opti-slice13}. It 
clearly shows the sidelobes at about -70 dB, which means this waveform is adequate for typical weather observations.


\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/lfm-isl-15us-opti-slice13.png}
\caption{Zero Doppler cut of the AF at the half power point.}
\label{fig:lfm-isl-15us-opti-slice13}
\end{figure}






\section{Non-Linear Frequency Modulation}
In this case, we vary the frequency of the signal non-linearly. Specifically, we let

\begin{equation}
  f(t) = a t^7 + t,
\end{equation}

and vary $a$ from 0 to 10. The two extremes for $a=0$ and $a=10$ are shown in figure \ref{fig:nlfm-functions}. 
Each function is applied over the pulse length $\tau$ of the signal.

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/nlfm-functions.png}
\caption{Functions describing the non-linear frequency sweeps}
\label{fig:nlfm-functions}
\end{figure}

For each function a waveform and ambiguity functions is generated and then evaluated according to the optimizations described
in Section \ref{s:quantifications}. We can then determine which waveform is best suited for our application in weather radars
or further change the setup to combine it with, e.g. amplitude tapering to achieve even better performance.


\subsection{Parameterized NLFM Results}
\label{s:nlfm-only-results}
Figure \ref{fig:nlfm-side-15us-opti} shows the results for varying NLFM waveforms in regards to ISL, MSL, and range resolution.
We find that the closer the frequency modulation function approaches an S-curve, the better the ISL becomes, though it is never
fantastic. The maximum ISL seems to be around -13 dB. The maximum sidelobe level decreases rapidly first to about -15 dB and
mostly decreases to about -20 dB, where it stays constant. The range resolution gets progressively coarser, starting at about 50 m
and increasing to about 500 m, meaning the mainlobe broadens. This also explains the decreasing and eventually constant MSL,
because the whole AF is taken up by the mainlobe with only minimal sidelobes.

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/nlfm-side-15us-opti.png}
\caption{Optimization results for NLFM}
\label{fig:nlfm-side-15us-opti}
\end{figure}




\subsection{Parameterized NLFM with Amplitude Tapering}
Next we try to optimize varying NLFM waveforms combined with Kaiser windowing. First,
look at the ISL in figure \ref{fig:nlfm-kaiser-15us-opti-isl}. Intuitively we find that the waveform that is most aggressively 
tapered generally has better ISL performance. The same seems true for the NLFM parameter. The ideal range for the NLFM parameter
looks to be around 3 all the way up to 10, with as low a Kaiser parameter as we can live with.

Next, let's look at the MSL in figure \ref{fig:nlfm-kaiser-15us-opti-msl}. The shape closely mirrors that of the ISL optimization,
so the same discussion applies to it.

\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/nlfm-kaiser-15us-opti-isl.png}
\caption{ISL optimization results for NLFM combined with Kaiser amplitude tapering}
\label{fig:nlfm-kaiser-15us-opti-isl}
\includegraphics[width=\imgsize]{figures/nlfm-kaiser-15us-opti-msl.png}
\caption{MSL optimization results for NLFM combined with Kaiser amplitude tapering}
\label{fig:nlfm-kaiser-15us-opti-msl}
\end{figure}


The PPR in Figure \ref{fig:nlfm-kaiser-15us-opti-ppr} is the same for each waveform, because it only depends on 
the shape of the amplitude tapering function determined by the Kaiser parameter. As described previously, the power decreases rapidly
as $\beta$ in the Kaiser window function increases.

Similar to the NLFM-only case in Section \ref{s:nlfm-only-results}, the range resolution
decreases slightly as the NLFM parameter $a$ increases. The same happens for an increasing Kaiser parameter.
The effect of both together is compounded such that a large $\beta$ and large $a$ result in a large decrease in range
resolution.


\begin{figure}[H]
\includegraphics[width=\imgsize]{figures/nlfm-kaiser-15us-opti-ppr.png}
\caption{PPR optimization results for NLFM combined with Kaiser amplitude tapering}
\label{fig:nlfm-kaiser-15us-opti-ppr}
\includegraphics[width=\imgsize]{figures/nlfm-kaiser-15us-opti-res.png}
\caption{Resolution optimization results for NLFM combined with Kaiser amplitude tapering}
\label{fig:nlfm-kaiser-15us-opti-res}
\end{figure}





\section{Effects of Impulse Response on the Ambiguity Function}

As the signal returns to the radar and passes through the receive chain, it will be distorted by the
impulse response of the filter and amplifier. Figure \ref{fig:pulsewoir-200us} shows a standard pulse
that is undistorted. 

\begin{figure}[!ht]
\includegraphics[width=\imgsize]{figures/pulsewoir-200us.png}
\caption{ Pulse without IR distortion}
\label{fig:pulsewoir-200us}
\end{figure}


On the other hand, figure \ref{fig:pulsewir-200us} shows the AF for a pulse that
has been distorted by the transfer function shown in figure \ref{fig:tf1}. 

\begin{figure}[!ht]
\includegraphics[width=\imgsize]{figures/pulsewir-200us.png}
\caption{ Pulse with IR distortion}
\label{fig:pulsewir-200us}
\end{figure}

\begin{figure}[!ht]
\includegraphics[width=\imgsize]{figures/tf1.png}
\caption{Transfer Function}
\label{fig:tf1}
\end{figure}

The distortion lengthened the signal and smoothed it out a bit.


