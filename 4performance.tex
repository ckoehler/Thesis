\section{Quantifications}
\subsection{Ambiguity Function}
The main tool to determine waveform performance is the Ambiguity Function (AF) (\cite{Levanon:2004}). It is defined as:

\begin{equation}
\label{eq:AF}
  |\chi(\tau,f_d)| = | \int_{-\infty}^\infty{u(t) u^*(t+\tau) e^{j2\pi f_d t} dt}|,
\end{equation}

where $u(t)$ is the complex envelope of the signal, $\tau$ is the delay on the delay axis, and $f_d$
is the Doppler frequency shift in the Doppler axis.
We can clearly see that, for $f_d = 0$, the AF reduces to the Autocorrelation Function (ACF).


For a simple rectangular pulse of the form $u(t)=\frac{1}{\sqrt{T}} rect(\frac{t}{T})$, the AF is:
\begin{align*}
  |\chi(\tau,f_d)| &= | \int_{-\infty}^\infty{u(t) u^*(t+\tau) e^{j2\pi f_d t} dt}| \\ 
  &= 
  \begin{cases}
    \frac{1}{T} \int_{-\frac{T}{2} + \tau}^{\frac{T}{2}}{e^{j2\pi f_d t}dt} & \text{for $0 \leq \tau \leq T$}, \\
    \frac{1}{T} \int_{-\frac{T}{2}}^{\frac{T}{2} + \tau}{e^{j2\pi f_d t}dt} & \text{for $-T \leq \tau < 0$}, \\
    0 & \text{otherwise}. \\
  \end{cases}
\end{align*}

Evaluate the integral:

\begin{align*}
  \frac{1}{T} \int_{-\frac{T}{2} + \tau}^{\frac{T}{2}}{e^{j2\pi f_d t}dt}
  &= foo \\ 
  &= bar 
\end{align*}

\subsection{Integrated Sidelobe Level}
The performance of each code is measured by calculating the Integrated Sidelobe Level (ISL), which is defined as (\cite{Keeler:1999}):

\begin{equation}
\label{ISL}
ISL = 10 \log \left(\frac{\sum\limits_{j} |s_j|^2}{\sum\limits_{k} |m_k|^2}\right)
\end{equation}

where $s_j$ is the power of the $j^{th}$ sidelobe, and $m_k$ the power of the $k^{th}$ mainlobe.

The lower the ISL, the better the performance of the code.

\subsection{3dB Spatial Resolution}
Another metric to evaluate the performance of a waveform is the 3dB spatial resolution in units of meters, i.e. the spatial delay.
The lower the value, the finer the resolution of the radar.


\subsection{Maximum Sidelobe Level}
Although the ISL is a good way to quantify waveform performance, it can be misleading. Sidelobes are very undesirable, so a waveform
that has overall low sidelobes except for one very dominant one will have a low ISL, but may not be performing well enough for actual use due
to the outlier sidelobe.

This metric determines the highest sidelobe level in the plane of the ambiguity function so it can be compared to the ISL.


\subsection{Pulse Power Ratio}
For amplitude weighting, another factor needs to be taken into consideration: Pulse Power Ratio. For a perfect pulse, 100\% of the signal
power is transmitted. For a weighted amplitude, however, that is not the case. We define the Pulse Power Ratio as follows:


\begin{equation}
\label{PPR}
PPR = \frac{\sum\limits_{\tau} A_w}{\sum\limits_{\tau} A_p}, 
\end{equation}

where $A_w$ is the weighted amplitude of the pulse, defined over the pulse length $\tau$, and $A_p$ is the equivalent amplitude of a simple,
unweighted pulse. We simply compare the total power of the weighted amplitude $A_w$ with the maximum possible amplitude of a pulse of the same
length, $A_p$.

This metric tells us how much power is lost by weighting the signal so we can include this aspect in our optimization calculations.



\section{Limitations}
\subsection{Doppler Effect for Weather Radars}
\label{s:dopplereffect}
One question for pulse compression performance is the effect of a Doppler shift on matched filter in the receiver. Any
received signal that has been affected by a Doppler shift will cause a mismatch in the matched filter of the receiver.
This is especially pronounced the higher the target velocity is. For atmospheric weather radars, we observe targets that
usually move 25 m/s at maximum, causing a Doppler shift of $f_d = \frac{2v}{\lambda} = \frac{50}{0.1} = 500\ Hz$ for S-band.

This mismatch effect on the matched filter has been quantified by Kelly and Wishner as follows (\cite{Kelly:1965}).

For a signal of length T, a target of velocity v, and signal bandwidth B, the return Doppler-shifted signal can be written 
as $T(1-\frac{2v}{c})=T-\Delta T$. If $\Delta T$ is much smaller than $T$, i.e.  $\Delta T << \frac{1}{B}$, the mismatch 
due to the Doppler effect can be neglected. In other words, $\frac{2v}{c}BT << 1$. For a $1\mu s$ pulse at 5 MHz bandwidth 
moving at 30 m/s, $0.001 << 1$ is true, so the Doppler effect can be ignored. We will see this confirmed later in the 
simulations.

The pulse compression ratio, $BT$, is not equal to unity, so the mismatch in the filter is compounded for highly compressed 
pulses, which also makes sense intuitively.

\subsection{Effects of amplifier impulse response on the Ambiguity function}

Next we will examine the effects of the amplifier in the receive chain on the pulse.
Recall the general AF (\ref{eq:AF}) and let the return signal part of it pass through the system
with the impulse response $h(t)$:

\begin{align*}
   \chi(t,f_d) &= |\int_{-\infty}^\infty{u(t) [(u^*(t+\tau) e^{j2\pi f_d t})*h(t)]\ dt}| \\
   &= |\int_{-\infty}^\infty{u(t) \int_{-\infty}^{\infty}{u^*(t'+\tau) e^{j2\pi f_d t'}h^*(t'-t) dt'}\ dt}| \\
   \iff \chi(t',f_d) &= |\int_{-\infty}^\infty{u^*(t'+\tau) e^{j2\pi f_d t'}\int_{-\infty}^{\infty}{u(t) h^*(t'-t) dt}\ dt'}| 
\end{align*}

We can easily see that applying the impulse response to the return signal is equivalent to applying it to the original pulse $u(t)$. 

\subsection{Quantization}

\subsection{Volume Scattering}
